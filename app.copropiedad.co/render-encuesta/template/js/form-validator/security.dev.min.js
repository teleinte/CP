(function(d,c){d.formUtils.addValidator({name:"spamcheck",validatorFunction:function(h,g,f){var e=g.valAttr("captcha");return e===h},errorMessage:"",errorMessageKey:"badSecurityAnswer"});d.formUtils.addValidator({name:"confirmation",validatorFunction:function(j,i,h,l,e){var g="",f=i.valAttr("confirm")||(i.attr("name")+"_confirmation"),k=e.find('input[name="'+f+'"]').eq(0);if(k){g=k.val()}else{console.warn('Could not find an input with name "'+f+'"')}return j===g},errorMessage:"",errorMessageKey:"notConfirmed"});d.formUtils.addValidator({name:"creditcard",validatorFunction:function(k,l,f,g,m){var e={amex:[15,15],diners_club:[14,14],cjb:[16,16],laser:[16,19],visa:[16,16],mastercard:[16,16],maestro:[12,19],discover:[16,16]},h=d.split(l.valAttr("allowing")||"");if(h.length>0){var j=false;d.each(h,function(n,o){if(o in e){if(k.length>=e[o][0]&&k.length<=e[o][1]){j=true;return false}}else{console.warn('Use of unknown credit card "'+o+'"')}});if(!j){return false}}if(k.replace(new RegExp("[0-9]","g"),"")!==""){return false}var i=0;d.each(k.split("").reverse(),function(n,o){o=parseInt(o,10);if(n%2===0){i+=o}else{o*=2;if(o<10){i+=o}else{i+=o-9}}});return i%10===0},errorMessage:"",errorMessageKey:"badCreditCard"});d.formUtils.addValidator({name:"cvv",validatorFunction:function(e){return e.replace(/[0-9]/g,"")===""&&(e+"").length==3},errorMessage:"",errorMessageKey:"badCVV"});d.formUtils.addValidator({name:"strength",validatorFunction:function(h,f,e){var g=f.valAttr("strength");if(g&&g>3){g=3}return d.formUtils.validators.validate_strength.calculatePasswordStrength(h)>=g},errorMessage:"",errorMessageKey:"badStrength",calculatePasswordStrength:function(e){if(e.length<4){return 0}var g=0;var f=function(h,o){var m="";for(var l=0;l<o.length;l++){var n=true;for(var k=0;k<h&&(k+l+h)<o.length;k++){n=n&&(o.charAt(k+l)==o.charAt(k+l+h))}if(k<h){n=false}if(n){l+=h-1;n=false}else{m+=o.charAt(l)}}return m};g+=e.length*4;g+=(f(1,e).length-e.length)*1;g+=(f(2,e).length-e.length)*1;g+=(f(3,e).length-e.length)*1;g+=(f(4,e).length-e.length)*1;if(e.match(/(.*[0-9].*[0-9].*[0-9])/)){g+=5}if(e.match(/(.*[!,@,#,$,%,^,&,*,?,_,~].*[!,@,#,$,%,^,&,*,?,_,~])/)){g+=5}if(e.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)){g+=10}if(e.match(/([a-zA-Z])/)&&e.match(/([0-9])/)){g+=15}if(e.match(/([!,@,#,$,%,^,&,*,?,_,~])/)&&e.match(/([0-9])/)){g+=15}if(e.match(/([!,@,#,$,%,^,&,*,?,_,~])/)&&e.match(/([a-zA-Z])/)){g+=15}if(e.match(/^\w+$/)||e.match(/^\d+$/)){g-=10}if(g<0){g=0}if(g>100){g=100}if(g<20){return 0}else{if(g<40){return 1}else{if(g<=60){return 2}else{return 3}}}},strengthDisplay:function(g,f){var e={fontSize:"12pt",padding:"4px",bad:"Very bad",weak:"Weak",good:"Good",strong:"Strong"};if(f){d.extend(e,f)}g.bind("keyup",function(){var m=d(this).val();var j=typeof e.parent=="undefined"?d(this).parent():d(e.parent);var h=j.find(".strength-meter");if(h.length==0){h=d("<span></span>");h.addClass("strength-meter").appendTo(j)}if(!m){h.hide()}else{h.show()}var l=d.formUtils.validators.validate_strength.calculatePasswordStrength(m);var i={background:"pink",color:"#FF0000",fontWeight:"bold",border:"red solid 1px",borderWidth:"0px 0px 4px",display:"inline-block",fontSize:e.fontSize,padding:e.padding};var k=e.bad;if(l==1){k=e.weak}else{if(l==2){i.background="lightyellow";i.borderColor="yellow";i.color="goldenrod";k=e.good}else{if(l>=3){i.background="lightgreen";i.borderColor="darkgreen";i.color="darkgreen";k=e.strong}}}h.css(i).text(k)})}});var b=function(f,e,h,g,i){d.ajax({url:f,type:"POST",cache:false,data:e.attr("name")+"="+h,dataType:"json",error:function(j){alert("Server validation failed due to: "+j.statusText);if(c.JSON&&c.JSON.stringify){alert(c.JSON.stringify(j))}},success:function(j){if(j.valid){e.valAttr("backend-valid","true")}else{e.valAttr("backend-invalid","true");if(j.message){e.attr(g.validationErrorMsgAttribute,j.message)}else{e.removeAttr(g.validationErrorMsgAttribute)}}if(!e.valAttr("has-keyup-event")){e.valAttr("has-keyup-event","1").bind("keyup",function(k){if(k.keyCode!=9&&k.keyCode!=16){d(this).valAttr("backend-valid",false).valAttr("backend-invalid",false).removeAttr(g.validationErrorMsgAttribute)}})}i()}})},a=function(){return false};d.formUtils.addValidator({name:"server",validatorFunction:function(l,i,g,k,f){var j=i.valAttr("backend-valid"),h=i.valAttr("backend-invalid"),e=document.location.href;if(i.valAttr("url")){e=i.valAttr("url")}else{if("serverURL" in g){e=g.backendUrl}}if(j){return true}else{if(h){return false}else{if(d.formUtils.eventType=="keyup"){return null}}}if(d.formUtils.isValidatingEntireForm){f.bind("submit",a).addClass("validating-server-side").addClass("on-blur");i.addClass("validating-server-side");b(e,i,l,g,function(){f.removeClass("validating-server-side").removeClass("on-blur").get(0).onsubmit=function(){};f.unbind("submit",a);i.removeClass("validating-server-side");i.valAttr("value-length",l.length);f.trigger("submit")});d.formUtils.haltValidation=true;return null}else{f.addClass("validating-server-side");i.addClass("validating-server-side");
b(e,i,l,g,function(){f.removeClass("validating-server-side");i.removeClass("validating-server-side");i.trigger("blur")});return null}},errorMessage:"",errorMessageKey:"badBackend",validateOnKeyUp:false});d.fn.displayPasswordStrength=function(e){new d.formUtils.validators.validate_strength.strengthDisplay(this,e);return this}})(jQuery,window);